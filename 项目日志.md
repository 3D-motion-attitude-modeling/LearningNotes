# é¡¹ç›®æ—¥å¿—

## 2022å¹´11æœˆ27æ—¥

**Kinectéƒ¨åˆ†**

* openposeè¿æ¥ç½‘ç»œæ‘„åƒå¤´

  1. æŸ¥çœ‹æ˜¯å¦æœ‰æ‘„åƒå¤´usbé©±åŠ¨ï¼š`ls /dev/v*` å¦‚æœç»“æœå«æœ‰ `/dev/video0` åˆ™æœ‰ã€‚

  2. æŸ¥çœ‹usbä¿¡æ¯ï¼š `lsusb` æŸ¥çœ‹å“ªä¸€ä¸ªæ˜¯è¿æ¥çš„æ‘„åƒå¤´ã€‚

     ç»æŸ¥ï¼Œkinectæ‘„åƒå¤´IDä¸º `045e:097a~e` 

* ä½¿ç”¨openposeæ¨¡å‹

  * https://github.com/CMU-Perceptual-Computing-Lab/openpose/blob/master/doc
  * cmdæ–¹æ³•ï¼šåœ¨ `~/3d_motion/openpose/openpose` ç›®å½•ä¸‹è¾“å…¥å‘½ä»¤ï¼Œæ³¨æ„é€€å‡ºcondaï¼š `conda deactivate`
  * å¾—åˆ°å§¿æ€ç‚¹ï¼ˆ2dï¼‰ï¼šä¿å­˜ä¸º `.json` æ–‡ä»¶ï¼Œæ³¨æ„ä¸“é—¨å‡†å¤‡ä¸€ä¸ªæ–‡ä»¶å¤¹å­˜æ”¾ï¼Œå› ä¸ºå®ƒä¼šä¿å­˜æ¯ä¸€å¸§çš„å§¿æ€ç‚¹ã€‚

* linuxç³»ç»Ÿå¡æ­»

  `ctrl+alt+T` æ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œï¼Œè¾“å…¥ `sudo pkill Xorg` æ³¨é”€æ¡Œé¢ï¼Œé‡æ–°ç™»é™†ç”¨æˆ·å³å¯ã€‚**ä¸è¦ç›´æ¥é‡å¯ï¼ï¼** 

## 2023å¹´2æœˆ17æ—¥

**Kinectéƒ¨åˆ†**

* å¼€å¯kinectæ—¶éœ€è¦ç®¡ç†å‘˜æƒé™ï¼ `sudo k4aviewer`

  å¦åˆ™ä¼šæŠ¥é”™ `Is the device being used by another application?`

* Kinect ä½¿ç”¨çš„ä¸»è¦æ–‡ä»¶çš„å®‰è£…ä½ç½®

  * `k4aviewer  /usr/bin/k4aviewer `
  * `k4a.h /usr/include/k4a/k4a.h`

## 2023å¹´2æœˆ18æ—¥

### **Kinect SDKå®‰è£…**

* è¿›å±•ï¼šå®‰è£…äº†é™„å¸¦ example çš„ Kinect SDKæºç ï¼› ä½¿ç”¨ cmake æˆåŠŸç¼–è¯‘ç¤ºä¾‹ç¨‹åºã€‚
* å®‰è£… Kinect SDK æºç ï¼šhttp://t.csdn.cn/rRdsC
  * 1.7.2å®‰è£…ninjaä¸€æ­¥ç»™çš„åŸŸåé”™è¯¯ï¼åº”ä¸º`https://github.com/ninja-build/ninja-git`
  * cmakeå‰éœ€è¦æ‰‹åŠ¨ä¸‹è½½ä¸€é¡¹ï¼ˆæ–‡æ¡£ä¸­æœ‰ï¼‰ï¼Œä¸‹è½½å¥½ä¹‹åå†cmakeã€‚æŠ¥é”™æ²¡å…³ç³»ï¼Œåªè¦æ£€æŸ¥ `/extern/libusb` ç­‰æ–‡ä»¶å¤¹ä¸­å·²ç»ä¸‹è½½å¥½æ–‡ä»¶å³å¯è¿›è¡Œåç»­æ­¥éª¤ã€‚
* ç¼–è¯‘ Kinect åº”ç”¨ç¨‹åº
  * åœ¨ `/examples/CMakelists.txt` ä¸­æ·»åŠ  `find_package(k4a REQUIRED)` ç­‰è¯­å¥ï¼ï¼ˆéå¸¸é‡è¦ï¼Œå¦åˆ™cmakeæ—¶ä¼šæŠ¥é”™ï¼šæ‰¾ä¸åˆ° k4a::k4aï¼‰
  * å…³äº cmake çš„æ›´å¤šå†…å®¹è¿˜éœ€å­¦ä¹ ã€‚
* å…¶ä»–
  * é‡åˆ°æŠ¥é”™æ—¶å…ˆè¯•è¯• **sudo** ï¼ï¼
  * è¿è¡Œç¨‹åºæ—¶æ³¨æ„ï¼Œå½“å‰ Kinect çš„ç¼–å·æ˜¯ 0ï¼Œ ä¼ å‚æ—¶ä¸è¦å‡ºé”™ã€‚
  * ä¸‹è½½æ—¶å¡ä½ï¼Œå¯èƒ½æ˜¯ github å´©äº†

---

### **Openpose ç¼–è¯‘é”™è¯¯**

- ä»Šå¤©é‡æ–°ç¼–è¯‘Openposeä»£ç ï¼Œå‡ºç°å¦‚ä¸‹é—®é¢˜ï¼š

  ```
  nvcc fatal : Unsupported gpu architecture 'compute_80' 
  ```

  æŸ¥é˜…èµ„æ–™å¾—çŸ¥ï¼Œæ˜¯å½“å‰ç”µè„‘æ˜¾å¡ç®—åŠ›ä¸æ”¯æŒ8.0ã€‚

  ç»è¿‡æŸ¥æ‰¾[Nvidiaå®˜ç½‘](https://developer.nvidia.com/cuda-gpus)ï¼Œæ˜¾å¡Quadro P4000çš„ç®—åŠ›ä¸º6.1ã€‚

  è§£å†³æ–¹æ³•å‚è€ƒ[ç½‘ç«™](https://blog.csdn.net/haiy2011/article/details/128968934)ï¼Œåœ¨ `openpose/cmake/Cuda.cmake` æ–‡ä»¶å¤¹ï¼Œå°†ä¸æ”¯æŒçš„ç®—åŠ›æ³¨é‡Šæ‰å³å¯ã€‚


- openposeæºä»£ç ç†è§£

  - `std::make_shared <FlirReader> (cameraParameterPath, cameraResolution, undistortImage, std::stoi(producerString));`

    ä¸Šè¿°ä»£ç è¡¨ç¤ºç”Ÿæˆä¸€ä¸ª`shared_ptr` , è¯¥æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªæ•°æ®ç±»å‹ä¸º `FlirReader` çš„æ•°æ®ï¼Œæ‹¬å·å†…ä¸ºå¯¹åº”æ•°æ®çš„æ„é€ å‡½æ•°æ‰€éœ€å‚æ•°ã€‚


  - ```c++
    // If custom user Worker in same thread
    else if (!userInputWs.empty())
    workersAux = mergeVectors(userInputWs, workersAux);
    // If OpenPose producer (same thread)
    else if (datumProducerW != nullptr)
    workersAux = mergeVectors({datumProducerW}, workersAux);
    ```

â€‹			   è¿™è¡Œä»£ç è¡¨æ˜ `userInputWs` å’Œ `{datumProducerW}` ä¸ºåŒä¸€ä¸ªç±»å‹ã€‚

## 2023å¹´2æœˆ19æ—¥

### **Openposeéƒ¨åˆ†â€”â€”3dè§£é‡Šå™¨ç¼–è¯‘**

ä»Šå¤©åœ¨å°è¯•åŠ å…¥ `WITH_3D_RENDERER` å’Œ `WITH_CERES` çš„æ ‡å¿—åé‡æ–°ç¼–è¯‘openposeæºä»£ç ï¼Œé‡åˆ°äº†å¦‚ä¸‹çš„BUGä¿¡æ¯ï¼š

- BUG:  `error: 'integer_sequence' is not a member of  'std'`

  ç»è¿‡æŸ¥è¯¢ä¿¡æ¯ï¼Œå‘ç°æ˜¯å½“å‰å®‰è£…çš„ ceres-solver ç‰ˆæœ¬ä¸åŒ¹é…æ‰€å¯¼è‡´çš„ã€‚å½“ä½¿ç”¨å½“å‰ [å®˜ç½‘](http://ceres-solver.org/installation.html#linux) ä¸‹è½½çš„ç‰ˆæœ¬ï¼ˆ `ceres-solver-2.1.0` ï¼‰å°†å‡ºç°ä¸Šè¿°é—®é¢˜ã€‚

  è§£å†³æ–¹æ³•æ˜¯å®‰è£…æ—§ç‰ˆæœ¬çš„ceres-solver, å¤§è‡´è¿‡ç¨‹ä¸ºå¸è½½æ–°ç‰ˆçš„ceres-solverï¼Œä¹‹åå®‰è£…1.14.0ç‰ˆæœ¬å³å¯ã€‚å…·ä½“æ“ä½œå‚è€ƒ[ç½‘å€](https://blog.csdn.net/qq_41586768/article/details/107541917)ï¼Œå…¶ä¸­ **ç¼–è¯‘ceres_curve_fiiting** æ­¥éª¤ä¸éœ€è¦æ“ä½œ

- WARNING:  åœ¨ä½¿ç”¨cmake guiè¿›è¡Œconfigureæ“ä½œæ—¶ï¼Œå‡ºç°æœ‰å…³`OpenGL_GL_PREFERENCE` çš„warningä¿¡æ¯ã€‚

  `OpenGL_GL_PREFERENCE` åŸå§‹è¢«è®¾ç½®ä¸º "LEGACY", ä½†æ˜¯Openposeæ¨èè®¾ç½®ä¸º â€œGLVNDâ€ã€‚

  æˆ‘ä»¬é‡‡ç”¨çš„è§£å†³æ–¹æ³•æ¯”è¾ƒæš´åŠ›ï¼Œåœ¨ `usr/local/share/cmake-3.25/Modules` ç›®å½•ä¸‹æ‰¾åˆ°ï¼Œ`FindOpenGL.cmake` æ–‡ä»¶ï¼Œå°†å…¶ä¸­å¦‚ä¸‹ä»£ç æ³¨é‡Šæ‰ï¼š

  ```cmake
  set(OpenGL_GL_PREFERENCE "LEGACY")
  if ("x${_OpenGL_GL_POLICY}x" STREQUAL "xx")
  	set(_OpenGL_GL_POLICY_WARN 1)
  endif()
  ```

  å¹¶ä¿®æ”¹ä¸ºï¼š

  ```cmake
  set(OpenGL_GL_PREFERENCE "GLVND")
  ```

  è¿™ç§åšæ³•ä¸æ¨èï¼Œåœ¨warningä¿¡æ¯ä¸­æç¤ºä½¿ç”¨command_policy()æ“ä½œï¼Œä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°æ­£ç¡®çš„ä½¿ç”¨æ–¹æ³•ã€‚

- **BUG:** 

  ```xml
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutSolidSphere'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutDisplayFunc'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutGetModifiers'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutLeaveMainLoop'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutInitWindowPosition'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutSwapBuffers'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutInitWindowSize'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutSolidCone'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutMouseFunc'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutMainLoopEvent'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutPostRedisplay'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutCreateWindow'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutInit'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutKeyboardFunc'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutMotionFunc'
  ../../src/openpose/libopenpose.so.1.7.0: undefined reference to `glutInitDisplayMode'
  collect2: error: ld returned 1 exit status
  examples/deprecated/CMakeFiles/tutorial_api_thread_2_user_input_processing_output_and_datum.bin.dir/build.make:176: recipe for target 'examples/deprecated/tutorial_api_thread_2_user_input_processing_output_and_datum.bin' failed
  make[2]: *** [examples/deprecated/tutorial_api_thread_2_user_input_processing_output_and_datum.bin] Error 1
  CMakeFiles/Makefile2:1176: recipe for target 'examples/deprecated/CMakeFiles/tutorial_api_thread_2_user_input_processing_output_and_datum.bin.dir/all' failed
  make[1]: *** [examples/deprecated/CMakeFiles/tutorial_api_thread_2_user_input_processing_output_and_datum.bin.dir/all] Error 2
  make[1]: *** Waiting for unfinished jobs....
  
  ```

  è¯¥é”™è¯¯äº§ç”Ÿçš„åŸå› ä¸º-lGLU -lGL -lglutæ²¡æœ‰ä¸ç¼–è¯‘å™¨é“¾æ¥ã€‚å‘ç°é”™è¯¯åŸå› æ˜¯é€šè¿‡å‚è€ƒè¯¥[ç½‘ç«™ ](https://community.khronos.org/t/error-undefined-reference/17579)ï¼Œä»¥åŠå’Œ ChatGPT çš„è¯¢é—®ä¸­ç†è§£çš„ã€‚

  ä½†æ˜¯ä¸Šè¿°ç½‘ç«™å¹¶æ²¡æœ‰ç»™å‡ºå¦‚ä½•åœ¨Openposeæºç çš„ç¼–è¯‘ä¸‹ï¼Œå®ç°é“¾æ¥æ“ä½œã€‚é€šè¿‡å‚è€ƒ[gitHubä¸ŠOpenposeçš„Issues](https://github.com/CMU-Perceptual-Computing-Lab/openpose/issues/440)ï¼Œæ‰¾åˆ°è§£å†³é—®é¢˜çš„å…³é”®æ˜¯ä¿®æ”¹Openposeç›®å½•ä¸‹çš„ `CMakeLists.txt` æ–‡ä»¶ï¼Œå°†å¦‚ä¸‹ä»£ç ä»ï¼š

  ```cmake
  if (WITH_3D_RENDERER)
    set(OpenPose_3rdparty_libraries ${OpenPose_3rdparty_libraries} ${GLUT_LIBRARY} ${OPENGL_LIBRARIES})
  endif (WITH_3D_RENDERER) 
  ```

  ä¿®æ”¹ä¸ºï¼š

  ```cmake
  if (WITH_3D_RENDERER)
    set(OpenPose_3rdparty_libraries ${OpenPose_3rdparty_libraries} ${GLUT_LIBRARY} ${OPENGL_LIBRARIES} -lGLU -lGL -lglut)
  endif (WITH_3D_RENDERER) 
  ```

  å³å¯æˆåŠŸé“¾æ¥ã€‚

- åœ¨ä»Šå¤©çš„debugç¯èŠ‚ä¸­ï¼ŒChatGPTè™½ç„¶æ²¡æœ‰ç»™å‡ºä»»ä½•ä¸€ä¸ªå¯ä»¥è§£å†³é—®é¢˜çš„æ–¹æ¡ˆï¼Œä½†æ˜¯é€šè¿‡åˆç†è¥é€ è¯­å¢ƒæè¿°é”™è¯¯ä¿¡æ¯ï¼Œ**å¯ä»¥å¸®åŠ©ç†è§£é—®é¢˜äº§ç”Ÿçš„åŸå› ï¼Œä»¥åŠç›¸å…³é™Œç”Ÿä»£ç æ–‡ä»¶æˆ–æ˜¯é™Œç”Ÿå‘½ä»¤è¡ŒæŒ‡ä»¤**ï¼Œä»è€Œé—´æ¥çš„å¸®åŠ©é—®é¢˜çš„è§£å†³ã€‚

---

åœ¨linuxä¸Šå®‰è£…äº†QQï¼Œç”¨äºå®æ—¶ä¸å¦ä¸€å°è®¾å¤‡è¿›è¡Œä¿¡æ¯é€šè®¯

---

### **ç›¸æœºæ ‡å®šçŸ¥è¯†ç¯‡**

* ç›¸æœºå°†ä¸‰ç»´ä¸–ç•Œä¸­çš„ç‰©ä½“è®°å½•åœ¨äºŒç»´çš„å›¾ç‰‡ä¸­ï¼Œå› æ­¤ï¼Œå¯ä»¥è®¤ä¸ºç›¸æœºæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¾“å…¥æ˜¯ä¸‰ç»´åœºæ™¯ï¼Œè¾“å‡ºä¸ºäºŒç»´å›¾åƒã€‚**ç›¸æœºæ ‡å®š**å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ•°å­¦æ¨¡å‹æ¥æè¿°è¿™ä¸ªå‡½æ•°ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨å®ƒçš„åå‡½æ•°ï¼Œç”±äºŒç»´å›¾åƒé‡å»ºä¸‰ç»´åœºæ™¯ã€‚

  ![](.\pictures\pictures for kw\ç›¸æœºæ ‡å®šåŸç†.png)

* **åæ ‡ç³»**

  ä¸ºäº†å¾—åˆ°æ•°å­¦æ¨¡å‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨åæ ‡ç³»ï¼š

  * **ä¸–ç•Œåæ ‡ç³»(world coordinate system)** ç°å®ä¸–ç•Œçš„ç»å¯¹åæ ‡ç³»ï¼Œä»¥ç°å®ä¸‰ç»´ç©ºé—´ä¸­æŸä¸€ç‚¹ä¸ºåŸç‚¹å»ºç³»ï¼Œæè¿°ç›¸æœºå’Œç‰©ä½“çš„åæ ‡ã€‚ ç”¨ `(Xw, Yw, Zw)` è¡¨ç¤ºåæ ‡å€¼ã€‚

  * **ç›¸æœº(camera)åæ ‡ç³»** ä»¥ç›¸æœºçš„å…‰å¿ƒä¸ºåŸç‚¹çš„åæ ‡ç³»ï¼Œæè¿°ç‰©ä½“ç›¸å¯¹äºç›¸æœºå…‰å¿ƒçš„ä½ç½®ã€‚ç”¨ `(Xc, Yc, Zc)` è¡¨ç¤ºåæ ‡å€¼ï¼Œç›¸æœºçš„å…‰è½´ä¸ºZè½´ï¼ŒXã€Yè½´åˆ†åˆ«å¹³è¡Œäºå›¾åƒåæ ‡ç³»çš„Xã€Yè½´ã€‚

    **å…‰å¿ƒ** å¤§å¤šæ•°ç›¸æœºéƒ½æ˜¯åˆ©ç”¨å°å­”æˆåƒåŸç†ã€‚å°†ç›¸æœºé€é•œç»„æŠ½è±¡ä¸ºä¸€ä¸ªå°å­”æ¨¡å‹ï¼Œå°å­”ä¸­å¿ƒå³ä¸ºå…‰å¿ƒã€‚

  * **å›¾åƒ(image)åæ ‡ç³»** ä»¥CCDå›¾åƒï¼ˆå³ç›¸æœºæ‹æ‘„åˆ°çš„åŸå§‹å›¾åƒï¼‰ä¸­å¿ƒä¸ºåæ ‡åŸç‚¹ï¼Œæè¿°å›¾ç‰‡ä¸­åƒç´ çš„ä½ç½®ã€‚ç”¨ `(x, y)` è¡¨ç¤ºåæ ‡å€¼ï¼Œå•ä½ä¸ºç°å®ç‰©ç†é•¿åº¦ï¼ˆå¦‚æ¯«ç±³ï¼‰ã€‚

  * **åƒç´ (pixel)åæ ‡ç³»** ä»¥æ•°å­—å›¾åƒçš„å·¦ä¸Šè§’ä¸ºåæ ‡åŸç‚¹ï¼Œæè¿°å›¾ç‰‡ä¸­åƒç´ çš„ä½ç½®ã€‚ç”¨ `(u, v)` è¡¨ç¤ºåæ ‡å€¼ï¼Œå•ä½ä¸ºä¸ªï¼ˆåƒç´ ä¸ªæ•°ï¼‰

    **åŸå§‹å›¾åƒ -> æ•°å­—å›¾åƒ** ç›¸æœºæ‹æ‘„çš„å›¾ç‰‡åŒ…å«è‹¥å¹²åƒç´ ï¼Œæ¯ä¸ªåƒç´ ç‚¹æœ‰å®ƒçš„é¢œè‰²ã€‚æ•°å­—å›¾åƒç”¨æ•°å­—è¡¨ç¤ºæ¯ä¸ªç‚¹çš„é¢œè‰²ã€‚

![](.\pictures\pictures for kw\å›¾åƒåæ ‡ç³»ä¸åƒç´ åæ ‡ç³».png)

* å†…å‚çŸ©é˜µ

  é‡‡ç”¨é½æ¬¡åæ ‡ï¼Œä½¿ç”¨çŸ©é˜µå°†ä¸Šå¼è¡¨ç¤ºä¸º

  ![](.\LearningNotes\pictures\pictures for kw\å›¾åƒåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³».jpg)

  å…¶ä¸­ `(u0, v0)` æ˜¯å›¾åƒåæ ‡ç³»åŸç‚¹åœ¨åƒç´ åæ ‡ç³»ä¸­çš„åæ ‡ï¼ˆç”±ä¸Šè¿°å®šä¹‰å¯çŸ¥ï¼Œåæ ‡ä¸ºå›¾åƒåˆ†è¾¨ç‡çš„ä¸€åŠï¼‰ï¼Œ`dx` å’Œ `dy` åˆ†åˆ«ä¸ºæ¯ä¸ªåƒç´ åœ¨å›¾åƒå¹³é¢å¯¹åº”æ–¹å‘ä¸Šçš„ç‰©ç†å°ºå¯¸ã€‚

  ç›¸æœºåæ ‡ç³»åˆ°å›¾åƒåæ ‡ç³»çš„è½¬æ¢ï¼Œå¦‚ä¸‹å›¾ï¼š

  ![](.\pictures\pictures for kw\ç›¸æœºåæ ‡ç³»åˆ°å›¾åƒåæ ‡ç³».jpg)

  ä¸Šå¼ä¸­XYZä¸ºç‰©ä½“åœ¨ç›¸æœºåæ ‡ç³»ä¸­çš„ä½ç½®ï¼Œä¸ºå…·ä½“æ•°å€¼ã€‚

  ç»“åˆä¸Šè¿°ä¸¤ä¸ªå˜æ¢ï¼Œæˆ‘ä»¬å¾—åˆ°**å†…å‚çŸ©é˜µ**
  $$
  M=
  \begin{bmatrix}
  \frac{1}{dx} & 0 & u0 \\
  0 & \frac{1}{dy} & v0 \\
  0 & 0 & 1
  \end{bmatrix}
  \begin{bmatrix}
  f & 0 & 0 \\
  0 & f & 0 \\
  0 & 0 & 1
  \end{bmatrix}
  =
  \begin{bmatrix}
  f_x & 0 & u0 \\
  0 & f_y & v0 \\
  0 & 0 & 1
  \end{bmatrix}
  $$
  å…¶ä¸­ fxï¼Œfy è¡¨ç¤ºåœ¨ç›¸æœºæ‹æ‘„çš„å›¾åƒä¸­ï¼Œé•¿åº¦ç­‰äºç„¦è· f çš„ä¸€æ®µä¸­åŒ…å«çš„åƒç´ ç‚¹ä¸ªæ•°ã€‚ç§° M ä¸ºå†…å‚çŸ©é˜µï¼Œæ˜¯å› ä¸ºçŸ©é˜µ M çš„å„ä¸ªå…ƒç´ å€¼åªä¸ç›¸æœºå†…éƒ¨å‚æ•°æœ‰å…³ã€‚**åˆ©ç”¨å†…å‚çŸ©é˜µï¼Œå¯ä»¥æ–¹ä¾¿åœ°ä»ç›¸æœºåæ ‡ç³»å˜æ¢åˆ°åƒç´ åæ ‡ç³»ã€‚**

* **å¤–å‚çŸ©é˜µ**

  è¦å¾—åˆ°ä¸–ç•Œåæ ‡ç³»åˆ°åƒç´ åæ ‡ç³»çš„å˜æ¢ï¼Œåˆ™éœ€è¦çŸ¥é“è¿™ä¸¤ä¸ªä¸‰ç»´åæ ‡ç³»ä¹‹é—´çš„ç›¸å¯¹æ—‹è½¬çŸ©é˜µ **R** (3Ã—3)å’Œç›¸å¯¹ä½ç§»çŸ©é˜µ **T** (3Ã—1)ã€‚ç”¨çŸ©é˜µè¡¨ç¤ºå˜æ¢ï¼š

  ![](.\pictures\pictures for kw\å¤–å‚çŸ©é˜µ.png)

  ç»¼ä¸Šï¼Œå³å¯å®ç°å®Œæ•´çš„å˜æ¢ã€‚ä¸Šå¼ä¸­ï¼ŒZ~c~ ä¸ºç‰©ä½“åˆ°å…‰å¿ƒçš„è·ç¦»ï¼Œå³**æ·±åº¦è·ç¦»**ï¼

* **ç•¸å˜æ¨¡å‹**

  å®é™…çš„ç›¸æœºå¹¶ä¸æ˜¯å®Œç¾çš„å°å­”æˆåƒæ¨¡å‹ï¼Œå› æ­¤å®é™…æˆåƒä¼šæœ‰ç•¸å˜ã€‚ç•¸å˜åŒ…æ‹¬**å¾„å‘ç•¸å˜**å’Œ**åˆ‡å‘ç•¸å˜**ç­‰ï¼Œæ˜¯ç”±äºç„¦å¹³é¢ä¸Šä¸åŒåŒºåŸŸå¯¹å›¾åƒçš„æ”¾å¤§ç‡ä¸åŒå½¢æˆçš„ç”»é¢æ‰­æ›²å˜å½¢çš„ç°è±¡ã€‚

  ä½¿ç”¨3ä¸ªç•¸å˜å‚æ•°çŸ«æ­£å¾„å‘ç•¸å˜ï¼ˆåŸç†ï¼šä»¥å…‰å¿ƒä¸ºåœ†å¿ƒï¼Œr=0å¤„æ³°å‹’å±•å¼€å–å‰å‡ é¡¹ï¼‰
  $$
  x_{rcorr}=x_p(1+k_1r^2+k_2r^4+k_3r^6) \\
  y_{rcorr}=y_p(1+k_1r^2+k_2r^4+k_3r^6)
  $$
  ä½¿ç”¨2ä¸ªç•¸å˜å‚æ•°æè¿°åˆ‡å‘ç•¸å˜
  $$
  x_{tcorr}=x_p+[2p_1x_py_p+p_2(r^2+2x_p^2)] \\
  y_{tcorr}=y_p+[p_1(r^2+2y_p^2)+2p_2x_py_p]
  $$

## 2023å¹´2æœˆ21æ—¥

### **å®‰è£… ROS for Azure Kinect DK**

* å®˜ç½‘æ•™ç¨‹ https://github.com/microsoft/Azure_Kinect_ROS_Driver

* å½“å‰ Kinect ç‰ˆæœ¬ä¸º1.4.1

* å®‰è£… ROS å®˜ç½‘æ•™ç¨‹ https://wiki.ros.org/installation/Ubuntu

  è·Ÿç€å®˜ç½‘æ•™ç¨‹ä¼šå‡ºé”™ `Command: 'catkin_make' not found`

* ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼ˆæ¥è‡ª https://blog.csdn.net/haiyinshushe/article/details/84256137ï¼‰

  1. `sudo sh -c '. /etc/lsb-release && echo "deb http://mirrors.ustc.edu.cn/ros/ubuntu/ $DISTRIB_CODENAME main" > /etc/apt/sources.list.d/ros-latest.list'`

  2. `sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-key 421C365BD9FF1F717815A3895523BAEEB01FA116`

     å¦‚æœä¸è¡Œï¼Œä¸­é—´çš„hkpå¯†é’¥éƒ¨åˆ†å¯ä»¥ä½¿ç”¨ `hkp://ha.pool.sks-keyservers.net:80  æˆ–  hkp://pgp.mit.edu:80`

  3. `sudo apt-get update`

  4. `sudo apt-get install ros-melodic-desktop-full`

  5. åˆå§‹åŒ–rosdep

     `sudo apt-get install python-rosdep`

     `sudo rosdep init`

     `rosdep update`

  6. æ·»åŠ rosç¯å¢ƒå˜é‡

     `echo "source /opt/ros/melodic/setup.bash" >> ~/.bashrc
     source ~/.bashrc`

  7. å®‰è£…rosinstall

  è‡³æ­¤ROSå®‰è£…å®Œæˆã€‚

* å®‰è£… Kinect ROS http://t.csdn.cn/rRdsC

  1. ä¸‹è½½ROSé©±åŠ¨

     `mkdir -p ~/KinectDK_ws/src
     cd ~/KinectDK_ws/src
     catkin_init_workspace
     git clone https://github.com/microsoft/Azure_Kinect_ROS_Driver.git`

  2. ä¸‹è½½ libk4a å’Œ libk4a-dev æ–‡ä»¶ï¼ˆç‰ˆæœ¬1.4.1ï¼‰https://packages.microsoft.com/ubuntu/18.04/prod/pool/main/libk/libk4a1.2/

  3. åˆ›å»ºæ–‡ä»¶å¤¹å­˜æ”¾ä¸Šè¿°æ–‡ä»¶

     `cd ~/KinectDK_ws/src
     mkdir -p ext/sdk`

     åœ¨sdkæ–‡ä»¶å¤¹ä¸‹å†åˆ›å»º3ä¸ªæ–‡ä»¶å¤¹ï¼š

     1. binæ–‡ä»¶å¤¹: æŠŠç¼–è¯‘ SDK æ—¶ build æ–‡ä»¶å¤¹é‡Œé¢çš„é‚£ä¸ª bin æ–‡ä»¶å¤¹ç›´æ¥æ‹·è´è¿‡æ¥
     2. includeæ–‡ä»¶å¤¹ï¼šSDK æºç é‡Œçš„includeæ–‡ä»¶å¤¹ä¸ä» deb æ–‡ä»¶é‡Œæå–å‡ºçš„ include æ–‡ä»¶å¤¹åˆå¹¶ï¼Œæ‹·è´è¿‡æ¥
     3. libæ–‡ä»¶å¤¹ï¼šä»debæ–‡ä»¶é‡Œæå–å‡ºçš„ä¸¤ä¸ªlibæ–‡ä»¶å¤¹åˆå¹¶ï¼Œæ‹·è´è¿‡æ¥ **æ³¨æ„ï¼šè¿™é‡Œæ˜¯ä¸¤ä¸ªlibæ–‡ä»¶**

     **æ³¨ï¼šæ‰“å¼€debæ–‡ä»¶çš„æ–¹æ³•** ä¸è¦è§£å‹ï¼Œå³é”®é€‰æ‹© `Open with other application` å†é€‰æ‹© `Archive Manager`

  4. ç¼–è¯‘åŠå¯ç”¨

     `cd ~/KinectDK_ws
     catkin_make
     catkin_make install
     source ./devel/setup.bash
     roslaunch azure_kinect_ros_driver driver.launch `

     `rviz`

     catlin_make install ä¸€æ­¥ä¼šæŠ¥é”™ï¼ŒåŸå› ä¸æ˜ã€‚ä¸ä¼šå½±å“åç»­æ“ä½œï¼ˆä¹Ÿè®¸ï¼‰

     **roslunch ä¸€æ­¥è‹¥æŠ¥é”™ï¼Œå°†kinecté‡å¯å³å¯**

  * é”™è¯¯æ±‡æ€»

    `rviz` éœ€è¦åœ¨å¦ä¸€ä¸ªå‘½ä»¤è¡Œä¸­å¼€å¯ï¼ˆroslaunchéœ€å¤„äºè¿è¡ŒçŠ¶æ€ï¼‰ï¼ŒåŒæ—¶é€€å‡ºcondaç¯å¢ƒï¼

## 2023å¹´2æœˆ25æ—¥

### ä½¿ç”¨ Ros æ ‡å®š Kinect ç›¸æœº

* å‚è€ƒæ–‡ç«  http://t.csdn.cn/zQKpg

* è¯¦ç»†æ­¥éª¤

  * å¼€å¯ ros å¯è§†åŒ–çª—å£

    `cd ~/KinectDK_ws
    catkin_make
    catkin_make install
    source ./devel/setup.bash
    roslaunch azure_kinect_ros_driver driver.launch `

    ç„¶åå¼€å¯å¦ä¸€ä¸ªå‘½ä»¤è¡Œ

    `rviz`

  * æ˜¾ç¤º Kinect ç›¸æœºå›¾åƒ

    `Add -> Image -> Image Topic -> /rgb/image_raw`

    ï¼ˆä¸Šé¢æ˜¯æ˜¾ç¤ºRGBå›¾åƒçš„ä¾‹å­ï¼Œä¹Ÿå¯ä»¥æ˜¾ç¤ºæ·±åº¦å›¾åƒç­‰ï¼‰

  * å®‰è£… ros æ ‡å®šåŒ…

    `sudo apt-get install ros-melodic-camera-calibration`

  * ç›¸æœºæ ‡å®š

    `rosrun camera_calibration cameracalibrator.py --size 8x6 --square 0.024 image:=/rgb/image_raw`


* ç”¨ openpose æ ‡å®šç›¸æœº

  * æŸ¥çœ‹ webcam `v4l2-ctl --list-devices`

  * å®˜æ–¹æ•™ç¨‹ [openpose/calibration_module.md at master Â· CMU-Perceptual-Computing-Lab/openpose Â· GitHub](https://github.com/CMU-Perceptual-Computing-Lab/openpose/blob/master/doc/advanced/calibration_module.md#introduction)

    **æ³¨æ„ï¼šæ ‡å®šæ—¶éœ€è¦æ‹æ‘„è¶³å¤Ÿçš„ç…§ç‰‡ï¼ˆè‡³å°‘çº¦150å¼ ï¼‰ï¼Œå¦åˆ™æ— æ³•äº§ç”Ÿæ ‡å®šç»“æœï¼Œä¼šæŠ¥é”™**  `image could not be opened!`

  * æ ‡å®šï¼šåœ¨ `/openpose/openpose` ä¸‹

    `../openpose/build/examples/calibration/calibration.bin --mode 1 --grid_square_size_mm 20.0 --grid_number_inner_corners "8x6" --camera_serial_number 18079958 --calibration_image_dir ../intrinsic/ --camera_parameter_folder models/cameraParameters/`

### ä¿®æ”¹Openposeæºç ï¼ŒåŠ å…¥KinectCameraæ ‡å¿—

å°è¯•ä¿®æ”¹Openposeæºç ï¼Œè¿›è¡Œå†ç¼–è¯‘ï¼Œå®ç°è¿‡ç¨‹ä¸­å‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š

- ç¼–è¯‘é”™è¯¯ï¼š`Syntax error: "(" unexpected` 

  å°†æºç æ–‡ä»¶å¤¹åä» `Openpose(copy)` æ”¹ä¸º  `Openpose-copy` å³å¯

- ç¼–è¯‘é”™è¯¯ï¼š

  ```xml
  error: â€˜FLAGS_kinect_cameraâ€™ was not declared in this scope
               FLAGS_flir_camera, FLAGS_flir_camera_index, FLAGS_kinect_camera, FLAGS_kinect_camera_index);
  ```

  C++å‘½ä»¤è¡Œè§£æåŒ… gflags ä½¿ç”¨é—®é¢˜ã€‚åœ¨`include\openpose\flags.hpp` ä¸­åŠ å…¥å¯¹æ–°flagçš„å®šä¹‰å³å¯ã€‚[å‚è€ƒç½‘é¡µ](https://gohalo.me/post/package-gflags-usage.html)

## é¡¹ç›®å°å­˜ï¼ˆ2023å¹´3æœˆ12æ—¥ï¼‰

- **å·²å®Œæˆçš„ä»»åŠ¡**

  1. å®Œæˆäº†Openposeåœ¨linuxç³»ç»Ÿä¸Šï¼ŒåŠ å…¥3Dè§£é‡Šå™¨åçš„æºç ç¼–è¯‘

  2. åˆæ­¥ä¿®æ”¹Openposeæºç ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤è¡Œï¼ŒæŒ‰æŒ‡å®šæ–¹å¼ï¼ˆä½¿ç”¨Kinectç›¸æœºä»£æ›¿Flirç›¸æœºè¯»å–æ•°æ®ï¼‰è¿è¡Œç¨‹åº

     ```
     ./build/examples/openpose/openpose.bin --kinect_camera
     ```

     å‘½ä»¤è¡Œå‰ä¸ºç¼–è¯‘`openpose.cpp`å®Œæˆåçš„äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼Œåä¸ºæŒ‡å®šçš„FLAGå‚æ•°ã€‚

     å…·ä½“ä»£ç ä¿®æ”¹å¯å‚çœ‹GitHubçš„projectä»“åº“çš„æ›´æ–°è®°å½•ã€‚

     ---

  3. å®‰è£… **Azure Kinect SDK**ï¼ŒåŒ…æ‹¬æŸ¥çœ‹å™¨ä¸ç”¨äºåç»­å¼€å‘çš„åŒ…ã€‚

  4. è¿è¡Œç¤ºä¾‹ç¨‹åºï¼Œèƒ½å¤Ÿé€šè¿‡è°ƒç”¨ **k4a** åŒ…ä¸­çš„å‡½æ•°å®ç°ç›¸æœºæ•°æ®çš„è¯»å–ï¼Œå¦‚å†…å‚ã€ç‚¹äº‘ä¿¡æ¯ç­‰ã€‚

  5. å®‰è£… **ROS** ç³»ç»Ÿï¼Œç”¨äºè¿›ä¸€æ­¥å¼€å‘ã€‚

  6. ä½¿ç”¨ **ROS** å’Œ **openpose** åˆ†åˆ«æ ‡å®š Kinect æ‘„åƒå¤´ã€‚

- **ä¹‹åçš„ä»»åŠ¡**

  1. å®ŒæˆKinectReaderçš„ç¼–å†™ï¼Œä½¿å¾—å¯ä»¥ç”¨Kinectä»£æ›¿Flirç›¸æœºå®Œæˆ3Dé‡å»ºä»»åŠ¡ï¼Œ**ä»£ç å„ä¸ªå‡½æ•°çš„å®ç°æ€è·¯å¯å‚è€ƒGitHubçš„projectä»“åº“æœ€æ–°çš„æ›´æ–°è®°å½•**ã€‚You Can Do Itï¼

  2. æŒ‰è®¡åˆ’è¯»å–Openposeè¾“å‡ºçš„å…³é”®ç‚¹çš„åæ ‡ï¼Œå¹¶é€šè¿‡ä¸ä¸Šå¤§å­¦é•¿äº¤æµï¼Œé¦–å…ˆå®ç°äºŒç»´å…³é”®ç‚¹åˆ°ä¸‰ç»´ç©ºé—´å…³é”®ç‚¹çš„æ˜ å°„ã€‚

  3. å®ç°é«˜æ•ˆçš„ä¸‰ç»´å…³é”®ç‚¹åæ ‡è¿½è¸ªï¼Œä½¿ç”¨å¡å°”æ›¼æ»¤æ³¢è§‚æµ‹å™¨å‡å°è·Ÿè¸ªè¯¯å·®

  4. å¼•å…¥éª¨éª¼æ¡†æ¶çš„çº¦æŸï¼Œé…åˆå…³é”®ç‚¹çš„è¿½è¸ªå…ˆå®ç°ä¸€ä¸ªæ‰‹è‡‚è¿åŠ¨çš„3Dé‡å»º

     ---

  5. å¼€å‘ Kinect æ—¶ï¼Œä¸ºäº†å°†æºä»£ç æ–‡ä»¶é“¾æ¥åˆ°å¯¹åº”çš„å¤´æ–‡ä»¶ï¼ˆä½äºï¼‰ï¼Œéœ€è¦ç¼–å†™ **CMakefile** æ–‡æ¡£ã€‚

  6. åœ¨ **openpose** ä¸­æ¥å…¥ Kinect çš„æ¥å£ï¼ˆå¦‚ k4aï¼‰ï¼Œä»è€Œèƒ½å¤Ÿåˆ©ç”¨ openpose ç›´æ¥è°ƒç”¨ Kinect SDK çš„å‡½æ•°ã€‚

- **é‡è¦æ–‡ä»¶çš„å®‰è£…ä½ç½®ä¸ä½¿ç”¨æ–¹æ³•**

  1. Openposeæºç ç¼–è¯‘

     åœ¨å®Œæˆæ–°ä»£ç çš„ç¼–å†™åï¼Œä½¿ç”¨ cmake å·¥å…·åœ¨ `openpose-copy\build` æ–‡ä»¶å¤¹ä¸‹å®ŒæˆConfigureä¸Generateï¼Œå‘½ä»¤ä¸ºï¼š

     ```
     cmake-gui ..
     ```

     ä¹‹åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œå®Œæˆç¼–è¯‘ï¼š

     ```
     make -j`nproc`
     ```

  2. ç½‘å¡é©±åŠ¨å®‰è£…

     å‚è€ƒç›®å½• `~/3d_motion/config/EW-7611ULB_Linux_Driver_1.0.1.2` ä¸‹çš„æ“ä½œè¯´æ˜å³å¯ã€‚

  
  3. æ‰“å¼€ Kinect æŸ¥çœ‹å™¨ï¼šåœ¨ä»»æ„ä½ç½® `sudo k4aviewer`
  
  4. é¡¹ç›®çš„æ ¹ç›®å½• `/home/threed_motion/3d_motion` ï¼Œä¸‹å±æ–‡ä»¶å¤¹ï¼š
     1. Azure-Kinect-Sensor-SDKï¼šSDK çš„å®‰è£…ä½ç½®ã€‚
     2. åœ¨ `./include/k4a/k4a.h` ä¸­å¯ä»¥æŸ¥çœ‹ Kinect æ‘„åƒå¤´ä½¿ç”¨çš„å‡½æ•°ã€‚
     3. åœ¨ `./examples`ä¸­å¯ä»¥æŸ¥çœ‹ç¤ºä¾‹ç¨‹åºã€‚åœ¨ç¤ºä¾‹ç¨‹åºæ‰€åœ¨æ–‡ä»¶å¤¹ä¸‹ `cmake` æ¥ç¼–è¯‘æ–‡ä»¶ï¼Œç„¶åä¾ç…§ readme è¿è¡Œã€‚
     4. KinectDK_wsï¼šROS çš„å®‰è£…ä½ç½®ã€‚
        * ä½¿ç”¨ ROSï¼š[æˆ³è¿™é‡Œ](#2023/2/21)
        * ä½¿ç”¨ ROS æ ‡å®šæ‘„åƒå¤´ï¼š[æˆ‘æ¥è¾£](#2023/2/25)
  
  5. KinectProgram ä¸ KinectVideo
  
     å­˜æ”¾ç¼–å†™çš„ Kinect ç¨‹åºä¸æ‹æ‘„çš„ Kinect è§†é¢‘çš„åœ°æ–¹ã€‚

## å¯åŠ¨ï¼ˆ2023å¹´10æœˆ1æ—¥ï¼‰

### openposeä¸‰ç»´é‡å»º

å…³é”®ä»£ç ï¼š

```c++
namespace op
{
    /**
     * 3D triangulation given known camera parameter matrices and based on linear DLT algorithm.
     * The returned cv::Mat is a 4x1 matrix, where the last coordinate is 1.
     */
    double triangulate(
        cv::Mat& reconstructedPoint, const std::vector<cv::Mat>& cameraMatrices,
        const std::vector<cv::Point2d>& pointsOnEachCamera);

    /**
     * 3D triangulation given known camera parameter matrices and based on linear DLT algorithm with additional LMA
     * non-linear refinement.
     * The returned cv::Mat is a 4x1 matrix, where the last coordinate is 1.
     * Note: If Ceres is not enabled, the LMA refinement is skipped and this function is equivalent to triangulate().
     */
    double triangulateWithOptimization(
        cv::Mat& reconstructedPoint, const std::vector<cv::Mat>& cameraMatrices,
        const std::vector<cv::Point2d>& pointsOnEachCamera, const double reprojectionMaxAcceptable);
}
```

é‡å»ºæ–¹æ³•ï¼š

DLT çº¿æ€§é‡å»º [DLT ç›´æ¥çº¿æ€§è½¬æ¢ç®—æ³• | Wayland's Blog (waylandwong.github.io)](https://waylandwong.github.io/dlt/)

### é‡å†™kinectWrapperç±»

å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼Œä½¿ç”¨ `k4a.h` åº“é‡å†™ `kinectWrapper.cpp` ã€‚

å®‰è£…ç¼–è¯‘æŒ‡å—ï¼š[GitHub - microsoft/Azure-Kinect-Sensor-SDK: A cross platform (Linux and Windows) user mode SDK to read data from your Azure Kinect device.](https://github.com/Microsoft/Azure-Kinect-Sensor-SDK)

åº“çš„å‚è€ƒæ–‡æ¡£ï¼š[Azure Kinect Sensor SDK: Reference (microsoft.github.io)](https://microsoft.github.io/Azure-Kinect-Sensor-SDK/master/modules.html)

åŒæ­¥Kinectè¯»å–å‚è€ƒï¼š

[åŸºäºKinect Azureçš„å¤šç›¸æœºæ•°æ®é‡‡é›†ï¼ˆä¸€ï¼‰_å¤šæ‘„åƒå¤´åŒæ­¥é‡‡é›†-CSDNåšå®¢](https://blog.csdn.net/qq_43707919/article/details/109340757)

[åŸºäºKinect Azureçš„å¤šç›¸æœºæ•°æ®é‡‡é›†ï¼ˆäºŒï¼‰_kinectç›¸æœºæ•°æ®è·å–-CSDNåšå®¢](https://blog.csdn.net/qq_43707919/article/details/109347961)

[åŒæ­¥å¤šä¸ª Azure Kinect DK è®¾å¤‡ | Microsoft Learn](https://learn.microsoft.com/zh-cn/azure/kinect-dk/multi-camera-sync)ï¼ˆå­˜åœ¨éœ€è¦åœ¨è½¯ä»¶ä¸Šè€ƒè™‘çš„å½±å“å½“å‰åŒæ­¥çŠ¶æ€çš„å› ç´ ï¼‰

- åœ¨Linuxä¸Šå®‰è£…Azure Kinect Sensor SDKæ—¶ï¼Œé€šè¿‡å¦‚ä¸‹è®¾ç½®ä¿è¯ç›¸æœºè®¾å¤‡å¯ä»¥ä¸åœ¨rootæƒé™ä¸‹è¿è¡Œç¨‹åºã€‚

  On Linux, once attached, the device should automatically enumerate and load all drivers. However, in order to use the Azure Kinect SDK with the device and without being 'root', you will need to setup udev rules. We have these rules checked into this repo under 'scripts/99-k4a.rules'. To do so:

  - Copy 'scripts/99-k4a.rules' into '/etc/udev/rules.d/'.
  - Detach and reattach Azure Kinect devices if attached during this process.

  Once complete, the Azure Kinect camera is available without being 'root'.

  ä¹Ÿè®¸æˆ‘å¯ä»¥ç†è§£ä¸ºä¸éœ€è¦æ·»åŠ sudoå°±å¯ä»¥è¿è¡Œæ‘„åƒå¤´çš„é©±åŠ¨ç¨‹åºæˆ–åŒ…å«æœ‰æ‘„åƒå¤´é©±åŠ¨åŒ…çš„ç¨‹åºï¼Œç›¸æ¯”ä¹‹ä¸‹é¥æ“ä½œæ†çš„ç¨‹åºæ˜¯éœ€è¦æ·»åŠ `sudo` å‘½ä»¤æ‰å¯ä»¥è¿è¡Œçš„ã€‚

- éœ€è¦åœ¨Kinect SDKä¸­æ‰¾åˆ°çš„å¯¹åº”å…ƒç´ ï¼š

  å…³é”®æŒ‡é’ˆï¼š

  - systemæŒ‡é’ˆï¼ˆç”¨äºæ§åˆ¶æ•´ä¸ªç›¸æœºç³»ç»Ÿï¼‰
    - GetCamerasï¼šè·å–ç›¸æœºåˆ—è¡¨
    - GetInstance(); ä¸ ReleaseInstance();ï¼šå®ä¾‹åŒ–
  - CameraæŒ‡é’ˆï¼ˆç”¨äºæ§åˆ¶å•ä¸ªç›¸æœºï¼‰
    - GetNextImage()ï¼šè·å–å›¾ç‰‡
    - GetNodeMap()ï¼šè·å–æ¯ä¸ªç›¸æœºçš„ GenICam èŠ‚ç‚¹æ˜ å°„ï¼Œç›¸å½“äºä¸€ä¸ªæ£€ç´¢å„ä¸ªç›¸æœºå‚æ•°çš„æŒ‡é’ˆ
    - Init()ï¼šåˆå§‹åŒ–
    - BeginAcquisition();ï¼šå¼€å§‹é‡‡é›†
    - EndAcquisition();ï¼šåœæ­¢é‡‡é›†
    - DeInit();ï¼šå»åˆå§‹åŒ–

  - ImageæŒ‡é’ˆï¼ˆç”¨äºå­˜æ”¾ç›¸æœºé‡‡é›†åˆ°çš„å›¾ç‰‡ï¼‰

    - convertï¼šå›¾åƒæ ¼å¼çš„è½¬æ¢
    - getXPaddingï¼šè·å–å›¾åƒåç§»
    - getwidthï¼šè·å–å›¾åƒå®½
    - getDataï¼šè·å–å›¾åƒæ•°æ®
    - GetStrideï¼šå›¾åƒæ•°æ®çš„æ­¥å¹…ï¼Œå³æ¯è¡Œæ•°æ®çš„å­—èŠ‚æ•°
    - IsIncompleteï¼šæ£€æŸ¥å®Œæ•´æ€§
    - GetImageStatusï¼šè·å–çŠ¶æ€

  - iNodeMapæŒ‡é’ˆï¼ˆè·å–å¹¶è®¾ç½®ç›¸æœºå‚æ•°ï¼‰

### åŒæ­¥è®¾ç½®

- k4a_device_get_sync_jack() å‡½æ•°å¯ä»¥æ£€æŸ¥è®¾å¤‡åŒæ­¥çº¿çš„è¿æ¥æƒ…å†µ
- k4a_device_configuration_t::wired_sync_mode è¯¥å‚æ•°å¯ä»¥è®¾è®¡ç›¸æœºçš„ä¸»ä»æ¨¡å¼
- k4a_device_get_capture() å‡½æ•°å¯ä»¥ä»ç›¸æœºä¸­è¯»å–å›¾ç‰‡åˆ°ä¸€ä¸ª capture_handle çš„ Buffer ä¸­

## 2023å¹´10æœˆ8å·

* ### é‡æ–°å®‰è£…Ubuntu 18.04ç³»ç»Ÿï¼š

  * ä¸‹è½½ä¸€ä¸ªubuntuç³»ç»Ÿé•œåƒåˆ°Uç›˜ä¸­
  * ç”¨Rufusè½¯ä»¶åˆ¶ä½œå¯åŠ¨ç›˜
  * è®¡ç®—æœºå¼€æœºæ—¶é€‰æ‹©Uç›˜å¯åŠ¨ï¼šå…ˆæŒ‰enter/f1/f12ç­‰é”®è¿›å…¥biosæ¨¡å¼ï¼Œç¦ç”¨æ‰secure bootï¼Œç„¶åé€€å‡ºbiosæ¨¡å¼åœ¨startupä¸­æ‰¾åˆ°Uç›˜å³å¯ï¼Œ**é‡‡ç”¨UEFIæ–¹å¼å®‰è£…è¾ƒå¥½**
  * å®‰è£…Ubuntu

* æ¢å¤2022.11.27çš„ç³»ç»Ÿå¤‡ä»½

  â€”â€”â€”â€”â€”â€”â€”ç´§æ€¥æƒ…å†µâ€”â€”â€”â€”â€”â€”â€”

  æ¢å¤å¤‡ä»½ä¹‹åç³»ç»Ÿä¸­å¤šå‡ºäº†ä¸€ä¸ªç”¨æˆ·ï¼Œå‡ºç°äº†æœªçŸ¥é”™è¯¯ï¼Œå´©ä¸ä½äº†ï¼

  é‡æ–°åˆ¶ä½œå¯åŠ¨ç›˜ï¼Œé‡æ–°å®‰è£…ï¼ï¼ï¼

  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”

* é‡æ–°å®‰è£…ä¹‹åï¼Œå…ˆç”¨ç½‘çº¿è¿æ¥ç½‘ç»œï¼

  * å®‰è£…åŸºæœ¬ä¾èµ–ï¼ˆä»£æ›¿åŸå…ˆæ¢å¤å¤‡ä»½çš„æ­¥éª¤ï¼Œç›´æ¥é‡æ–°å¼€å§‹ï¼ï¼‰ï¼š
    * sudo apt upgrade
    * sudo apt install build-essential
    * sudo apt install cmake

* å®‰è£…æ— çº¿ç½‘å¡é©±åŠ¨ï¼ˆä»…é€‚ç”¨äºå½“å‰å‹å·ç½‘å¡ï¼šrealtek 8821cuï¼‰ï¼š

  https://gitcode.net/mirrors/maxhw/rtl8821cu?utm_source=csdn_github_accelerator

  é…ç½®æ— çº¿ç½‘ç»œï¼š

  https://blog.csdn.net/weixin_40358083/article/details/82864220

* å®‰è£…æ˜¾å¡é©±åŠ¨ï¼šhttps://blog.csdn.net/weixin_44348719/article/details/125049064

  * æŸ¥çœ‹æ˜¾å¡å‹å·ï¼šæ­¤å¤„å¾—åˆ°çš„æ˜¾å¡ä¸º GeForce RTX 3080 Lite Hash Rate
  * `sudo apt-get install lightdm` ä¸€æ­¥ï¼Œä¼šå‡ºç°ä¸€ä¸ªå›¾å½¢ç•Œé¢ï¼Œé€‰æ‹©lightdmå³å¯ã€‚
  * åœ¨ç¬¬å››æ­¥è¿›å…¥ttyæ¨¡å¼åï¼Œéœ€è¦å†æ¬¡è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè®°å¾—**æå‰è®°ä½ç”¨æˆ·å**ã€‚

* å®‰è£…teamviewerï¼šå®˜ç½‘ä¸‹è½½å³å¯ã€‚[Linux (teamviewer.cn)](https://www.teamviewer.cn/cn/download/linux/)

ä»Šæ—¥ä»»åŠ¡å®Œæˆ  åˆå›åˆ°æœ€åˆçš„èµ·ç‚¹ğŸ¶~

* å†æ¬¡å¤‡ä»½ï¼šhttps://blog.csdn.net/amnesiagreen/article/details/104572812


## 2023å¹´10æœˆ9å·

### é‡æ–°å®‰è£…kinect SDKï¼š

å‚è€ƒç½‘ç«™ï¼šhttps://learn.microsoft.com/zh-cn/azure/kinect-dk

* é¦–å…ˆè¦ä¸‹è½½å‡ ä¸ªä¾èµ–åŒ…ï¼Œè¯¦è§æ•™ç¨‹ï¼š[Ubuntu20.04å’Œ22.04é…ç½®Azure Kinect Sensor SDK-CSDNåšå®¢](https://blog.csdn.net/OTZ_2333/article/details/124025953)

  ä¸‹è½½å¥½ `libk4a1.4_1.4.1_amd64.deb` `libk4a1.4-dev_1.4.1_amd64.deb` `k4a-tools_1.4.1_amd64.deb`ä¹‹åï¼Œæ”¾å…¥é¡¹ç›®ä¸‹åŒä¸€æ–‡ä»¶å¤¹ï¼Œä¾æ¬¡è§£å‹å³å¯ã€‚æ³¨æ„ï¼šè§£å‹k4a-toolsçš„æ—¶å€™éœ€è¦å…ˆ `apt install libsoundio1`

* æµ‹è¯•ä¸€ä¸‹ï¼Œè¾“å…¥ `k4aviewer` å³å¯æ‰“å¼€æ‘„åƒå¤´ã€‚

### openposeä¾èµ–å®‰è£…

* å®‰è£…CUDAï¼šhttps://blog.csdn.net/my__blog/article/details/125720601 æ­¤å¤„ä¸‹è½½çš„æ˜¯CUDA11.8

* å®‰è£…cudnnï¼š

  ä¸‹è½½debï¼š https://developer.nvidia.com/rdp/cudnn-download

  å®‰è£…ï¼š

  ```bash
  sudo dpkg -i cudnn-local-repo-ubuntu1804-8.9.4.25_1.0-1_amd64.deb 
  sudo apt-get update
  cd /var/cudnn-local-repo-ubuntu1804-8.9.4.25/
  sudo dpkg -i libcudnn8_8.9.4.25-1+cuda11.8_amd64.deb
  sudo dpkg -i libcudnn8-dev_8.9.4.25-1+cuda11.8_amd64.deb 
  sudo dpkg -i libcudnn8-samples_8.9.4.25-1+cuda11.8_amd64.deb 
  ```

  æµ‹è¯•å®‰è£…æ˜¯å¦æˆåŠŸ(åˆ›å»ºä¸€ä¸ªç©ºé—²æ–‡ä»¶å¤¹å¹¶è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œæ‰§è¡Œä¸‹è¿°æ“ä½œ)ï¼š

  ```bash
  cp -r /usr/src/cudnn_samples_v8/ ./
  cd cudnn_samples_v8/mnistCUDNN/
  sudo make clean
  sudo make
  ```

  æµ‹è¯•è¿‡ç¨‹çš„æŠ¥é”™åŠè§£å†³ï¼š

  ```
  ERROR:
  test.c:1:10: fatal error: FreeImage.h: No such file or directory
   #include "FreeImage.h"
  
  SOLVE:
  (https://lequ7.com/guan-yu-ubuntu2004ubuntu2004-xian-ka-qu-dong-cudacudnn-guan-wang-an-zhuang-jiao-cheng.html) â€”â€” å®‰è£…ç¼ºå°‘çš„ä¾èµ–
  sudo apt-get install g++ freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libglu1-mesa libglu1-mesa-dev
  sudo apt-get install libfreeimage3 libfreeimage-dev
  ```

* å®Œæˆä»£ç ç¼–è¯‘åï¼Œè¿è¡Œdemoæ–‡ä»¶å‡ºç°æœ‰å…³**CUDNN**çš„æŠ¥é”™ã€‚

  åœ¨æ–°çš„å®éªŒä¸»æœºä¸Šï¼Œç”±äºæ˜¾å¡å‹å·æ”¹å˜ï¼Œä¸ºRTX 3080æ˜¾å¡ã€‚å…¶æ‰€éœ€çš„æœ€ä½CUDAç‰ˆæœ¬ä¸º`11.x` ã€‚äºæ˜¯åœ¨è¯¥ä¸»æœºä¸Šä½¿ç”¨çš„ç‰ˆæœ¬ä¿¡æ¯ä¸ºï¼š

  ```
  CUDA: 11.7
  Cudnn: 8.9.4
  ```

  ç»è¿‡æŸ¥é˜…èµ„æ–™ï¼Œåœ¨cmake-guiè®¾ç½®æ—¶ï¼Œå–æ¶ˆå‹¾é€‰`USE_CUDNN` ï¼Œé‡æ–°ç¼–è¯‘å³å¯ã€‚è¿™ä¼šå¸¦æ¥æ˜¾å¡å†…å­˜å ç”¨å¢åŠ çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡å‡å°è§†é¢‘åˆ†è¾¨ç‡æ¥è§£å†³ï¼ŒopenposeåŸæ–‡å¦‚ä¸‹ï¼š

  ```
  The cuDNN library is not mandatory, but required for full keypoint detection accuracy. In case your graphics card is not compatible with cuDNN, you can disable it by unchecking USE_CUDNN in CMake.
  
  Then, you would have to reduce the --net_resolution flag to fit the model into the GPU memory. You can try values like 640x320, 320x240, 320x160, or 160x80 to see your GPU memory capabilities. After finding the maximum approximate resolution that your GPU can handle without throwing an out-of-memory error, adjust the net_resolution ratio to your image or video to be processed (see the --net_resolution explanation from doc/advanced/demo_advanced.md), or use -1 (e.g., --net_resolution -1x320).
  ```

* è¿è¡Œdemoä½†æ˜¯æ²¡æœ‰ä»»ä½•éª¨éª¼ç‚¹ï¼Œå¯èƒ½çš„åŸå› æ˜¯modelæ²¡æœ‰ä¸‹è½½æˆåŠŸã€‚

  å¯ä»¥é€šè¿‡æ£€æŸ¥openposeæ–‡ä»¶ä¸‹modelsæ–‡ä»¶çš„å¤§å°æ¥éªŒè¯ï¼Œå¦‚æœæœ‰å®Œæ•´çš„æ¨¡å‹ï¼Œè¯¥æ–‡ä»¶å¤¹å¤§å°åº”è¯¥ä¸º`734M`å·¦å³ã€‚

  å¦‚æœopenposeæä¾›çš„æ¨¡å‹ä¸‹è½½åœ°å€ä¸èƒ½è®¿é—®ï¼Œå¯ä»¥è®¿é—®è¯¥æ¨¡å‹ä¸‹è½½é“¾æ¥ï¼š

  https://www.kaggle.com/datasets/changethetuneman/openpose-model/

  ä¹‹åæ ¹æ®modelsæ–‡ä»¶ä¸­æ¨¡å‹çš„åç§°ï¼Œå°†ç©ºå£³æ¨¡å‹æ›¿æ¢ä¸ºä¸‹è½½åˆ°çš„å®Œæ•´æ¨¡å‹å³å¯ã€‚

* åŠ å…¥3dè§£é‡Šå™¨çš„æ¨¡å‹ç¼–è¯‘ï¼š

  é¦–å…ˆéœ€è¦æ ¹æ® [å®˜ç½‘](http://ceres-solver.org/installation.html#linux) å®‰è£…Ceresçš„å¿…è¦ä¾èµ–ï¼Œä¹‹åæ ¹æ®å‚è€ƒ[ç½‘å€](https://blog.csdn.net/qq_41586768/article/details/107541917)å®‰è£…1.14ç‰ˆæœ¬çš„Ceresã€‚

  å®Œæˆä¸Šè¿°å·¥ä½œåï¼Œé‡æ–°æ‰“å¼€cmake-guiï¼Œå‹¾é€‰ï¼š

  - WITH_3D_RENDERER
  - WITH_CERES
  - WITH_EGIEN: AUTOBUILD

  é‡æ–°è¿›è¡Œè®¾ç½®ä¸ç¼–è¯‘ï¼Œå‡ºç°çš„åç»­é—®é¢˜å¯ä»¥å‚è€ƒä¹‹å‰æ—¥å¿—ï¼ˆ23å¹´2æœˆ19æ—¥ï¼‰çš„è®°å½•ã€‚

## 2023å¹´10æœˆ10å·

å°†å›¾ç‰‡è½¬æ¢ä¸ºopencv matrixï¼š[How to convert k4a_image_t to opencv matrix? (Azure Kinect Sensor SDK) - Stack Overflow](https://stackoverflow.com/questions/57222190/how-to-convert-k4a-image-t-to-opencv-matrix-azure-kinect-sensor-sdk)

- å®Œæˆäº†kinectWrapperçš„æ’°å†™

## 2023å¹´10æœˆ11å·

### æ¢ç©¶å¦‚ä½•ç¼–è¯‘Kinect SDKå¹¶åœ¨é¡¹ç›®ä¸­å®ç°åº“çš„å¼•ç”¨

* ç»§ç»­ç©vscodeï¼

  * å®‰è£…ç»„ä»¶ï¼šC/C++; C/C++ Snippets; Code Runner; Include Autocomplete
  * è·‘é€šäº†HelloWorldï¼
  * å°è¯•include kinectçš„åº“æ—¶å‡ºç°äº†é—®é¢˜ï¼å‘ç°k4a.libå’Œk4a.dllç¼ºå¤±ï¼ŒåŸå› æ˜¯æ²¡æœ‰ç¼–è¯‘SDKçš„æºç ......ä¹‹å‰å®‰è£…çš„k4avieweråªæ˜¯ç›¸å½“äºä¸€ä¸ªè½¯ä»¶ï¼Œæ— æ³•è¿›è¡Œä»£ç å¼€å‘ã€‚ï¼ˆä¹‹å‰åœ¨2æœˆ18å·å·²ç»åšè¿‡ä¸€æ¬¡SDKæºç çš„ç¼–è¯‘ï¼Œä½†æ˜¯æˆ‘å¿˜åŠ›ï¼ˆæ‚²ï¼‰

* ç¼–è¯‘Kinect SDKæºç ï¼š[Azure-Kinect-Sensor-SDK/docs/building.md at develop Â· microsoft/Azure-Kinect-Sensor-SDK Â· GitHub](https://github.com/microsoft/Azure-Kinect-Sensor-SDK/blob/develop/docs/building.md)

  é¦–å…ˆ**ä¸‹è½½æºç **åˆ°æ–‡ä»¶å¤¹ä¸­ï¼š`git clone https://github.com/microsoft/Azure-Kinect-Sensor-SDK.git`

  åœ¨ç¼–è¯‘ä¹‹å‰éœ€è¦**å‡†å¤‡å¥½ä¾èµ–**ï¼Œåœ¨ *Azure-Kinect-Sensor-SDK/scripts/docker* ä¸­ç»™å‡ºäº†ä¸‰ç§å®‰è£…ä¾èµ–çš„æ–¹å¼ï¼šDockerfileã€setup-ubuntu.shä»¥åŠä¾ç…§sources.listæ‰‹åŠ¨å®‰è£…ã€‚è¿™é‡Œé‡‡ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå‚è€ƒ[Ubuntu18.04+Azure Kinect DKé…ç½®å…¨è¿‡ç¨‹ï¼ˆSDKæºç +ROSï¼‰_azure kinect dk + ros18.04-CSDNåšå®¢](https://blog.csdn.net/qq_27399933/article/details/107356117?spm=1001.2101.3001.6661.1&utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-107356117-blog-124025953.235^v38^pc_relevant_sort_base3&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-107356117-blog-124025953.235^v38^pc_relevant_sort_base3&utm_relevant_index=1)

  ```bash
  sudo chmod +x setup-ubuntu.sh
  ./setup-ubuntu.sh
  ```

  ç„¶åå°±æ˜¯**ç¼–è¯‘**äº†ï¼ç¼–è¯‘è¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ä¸‹è½½ä¸€äº›ä¸œè¥¿ï¼Œå…¶ä¸­libyuvåŒ…æ— æ³•ä¸‹è½½ï¼Œéœ€è¦ä¿®æ”¹ä¸‹è½½æºï¼š

  åœ¨æ ¹ç›®å½•ï¼ˆAzure-Kinect-Sensor-SDKï¼‰ä¸­`ls -a` æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶ï¼Œæ‰¾åˆ°è¢«éšè—çš„.gitmodulesï¼Œç„¶åå°†libyuvçš„ä¸‹è½½åœ°å€æ”¹ä¸º `https://github.com/lemenkov/libyuv.git`

  å¼€å§‹ç¼–è¯‘ï¼š

   ```bash
  mkdir build
  cd build
  cmake .. -GNinja -DCMAKE_BUILD_TYPE=Debug
  ninja
   ```

  æœ€åå°†SDKä¸­çš„åŠ¨æ€é“¾æ¥åº“ç­‰ç›¸å…³æ–‡ä»¶å®‰è£…åˆ°ç³»ç»Ÿç›®å½•ä¸­ä¾›å…¶ä»–é¡¹ç›®ä½¿ç”¨ï¼š

  `sudo ninja install`

  è‡³æ­¤ç¼–è¯‘å®Œæˆï¼Œåº”è¯¥å¯ä»¥è°ƒç”¨libäº†â€¦â€¦å§ï¼Ÿ

  NOï¼çªç„¶å‘ç°ï¼ŒLinuxç³»ç»Ÿä¸­æ²¡æœ‰.libåç¼€åï¼Œè€Œæ˜¯ç”¨.soè¡¨ç¤ºåŠ¨æ€é“¾æ¥åº“ï¼ï¼ï¼ˆ.aè¡¨ç¤ºé™æ€é“¾æ¥åº“ï¼‰

  æœ‰å…³k4açš„é“¾æ¥åº“åœ¨ `/usr/local/lib` ä¸­ï¼

* è®°ä½å¤´æ–‡ä»¶å’Œé“¾æ¥åº“çš„ä½ç½®ï¼š `/usr/include/k4a` å’Œ `/usr/local/lib`

* ç”¨vscodeç¼–å†™è‡ªå·±çš„kinectç¨‹åº

  * åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸­è¿è¡Œ `code .` æ‰“å¼€vscodeï¼Œ `.` è¡¨ç¤ºä»¥å½“å‰æ–‡ä»¶å¤¹ä½œä¸ºvscodeé¡¹ç›®ç›®å½•ã€‚

  * åˆ›å»ºcppæ–‡ä»¶ï¼Œå¼€å§‹å†™ä»£ç ï¼

  * åœ¨cppæ–‡ä»¶å¼€å¤´å¼•ç”¨k4aç›¸å…³åº“ï¼Œå¦‚ `#include<k4a/k4a.h>`

  * ç‚¹å‡»Terminal -> Configure Default Build Taskåˆ›å»ºtasks.jsonï¼Œè¿™æ˜¯åç»­ç¼–è¯‘çš„å…³é”®ã€‚ä¸€èˆ¬é€‰æ‹©C/C++ : g++ build active file

  * **åœ¨tasks.jsonçš„argså‚æ•°ä¸­ï¼Œæ·»åŠ ï¼š**

    ```
    "-L/usr/local/lib",
    "-lk4a"
    ```

    -LæŒ‡å®šäº†é“¾æ¥åº“æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œ è€Œ-læŒ‡å®šäº†å…·ä½“ç”¨åˆ°çš„é“¾æ¥åº“ã€‚

  * ç‚¹å‡»View -> Command Paletteï¼ˆæˆ–å¿«æ·é”®ctrl+shift+Pï¼‰-> C/C++: Edit Configurations (UI) **åˆ›å»ºc_cpp_properties.jsonï¼Œåœ¨includePathå‚æ•°ä¸­æ·»åŠ ï¼š**

    ```
    "/usr/include/k4a"
    ```

  * å›åˆ°cppæ–‡ä»¶ï¼Œç‚¹å‡»Terminal -> Run Build Taskï¼ˆæˆ–å¿«æ·é”®ctrl+shift+Bï¼‰å³å¯åœ¨åŒä¸€æ–‡ä»¶å¤¹ä¸‹æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚

## 2023å¹´10æœˆ13å·

### ä¿®æ”¹openposeæºç çš„CMakeListæ–‡ä»¶å¼•å…¥Azure Kinect SDK

åœ¨ä»æºç ä¸­ç¼–è¯‘Kinect SDKåï¼Œç¡®ä¿åœ¨ubuntuä¸­å¯ä»¥æ‰¾åˆ°`k4a.lib`æ–‡ä»¶ã€‚

- å¢åŠ cmake-guiç¼–è¯‘é€‰é¡¹ï¼Œå¹¶è®¾ç½®ç¼–è¯‘define

  ```cmake
  option(WITH_KINECT_CAMERA "Add KINECT camera code (requires Azure Kinect SDK already installed)." OFF)
  
  if (WITH_KINECT_CAMERA)
    # OpenPose flags
    add_definitions(-DUSE_KINECT_CAMERA)
  endif (WITH_KINECT_CAMERA)
  ```

- æŸ¥æ‰¾ K4A åº“

  ```cmake
  if (WITH_AZURE_KINECT)
    # Azure Kinect SDK
    find_package(k4a REQUIRED)
    if (NOT k4a_FOUND)
      message(FATAL_ERROR "Azure Kinect SDK not found. Either turn off the `WITH_AZURE_KINECT` option or specify the path to
        the Azure Kinect SDK includes and libs.")
    endif (NOT k4a_FOUND)
  endif (WITH_AZURE_KINECT)
  ```

- å°†å¤´æ–‡ä»¶åŠ å…¥é¡¹ç›®

  ```cmake
  if (WITH_AZURE_KINECT)
      include_directories(SYSTEM ${K4A_INCLUDE_DIRS})
  endif (WITH_AZURE_KINECT)
  ```

- åœ¨é“¾æ¥é˜¶æ®µå°† k4a åº“é“¾æ¥åˆ° OpenPose é¡¹ç›®ä¸­

  ```cmake
  if (WITH_AZURE_KINECT)
      set(OpenPose_3rdparty_libraries ${OpenPose_3rdparty_libraries} ${K4A_LIB})
  endif (WITH_AZURE_KINECT)
  ```

#### æŠ¥é”™ï¼š

```bash
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_capture_get_color_image'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_start_cameras'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_image_get_device_timestamp_usec'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_image_get_width_pixels'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_close'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_get_serialnum'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_open'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_image_reference'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_get_installed_count'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_image_release'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_capture_release'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_get_capture'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_set_color_control'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_stop_cameras'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_device_get_sync_jack'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_image_get_height_pixels'
../../src/openpose/libopenpose.so.1.7.0: undefined reference to `k4a_image_get_buffer'
collect2: error: ld returned 1 exit status
examples/tutorial_api_cpp/CMakeFiles/02_whole_body_from_image_default.bin.dir/build.make:175: recipe for target 'examples/tutorial_api_cpp/02_whole_body_from_image_default.bin' failed
make[2]: *** [examples/tutorial_api_cpp/02_whole_body_from_image_default.bin] Error 1
CMakeFiles/Makefile2:1254: recipe for target 'examples/tutorial_api_cpp/CMakeFiles/02_whole_body_from_image_default.bin.dir/all' failed
make[1]: *** [examples/tutorial_api_cpp/CMakeFiles/02_whole_body
```

è§£å†³æ–¹æ³•ï¼š

`-lk4a` æ˜¯å‘Šè¯‰é“¾æ¥å™¨ä½¿ç”¨åä¸º `k4a` çš„åº“çš„æ ‡å¿—ï¼Œç¼ºå°‘è¿™ä¸ªæ ‡å¿—å¯èƒ½å¯¼è‡´é“¾æ¥é”™è¯¯ã€‚

```cmake
if (WITH_AZURE_KINECT)
    set(OpenPose_3rdparty_libraries ${OpenPose_3rdparty_libraries} ${K4A_LIB} -lk4a)
endif (WITH_AZURE_KINECT)
```

### è¿›è¡Œç›¸æœºæ ‡å®š

openposeå‚è€ƒç½‘ç«™ï¼š[openpose/doc/advanced/calibration_module.md at master Â· CMU-Perceptual-Computing-Lab/openpose Â· GitHub](https://github.com/CMU-Perceptual-Computing-Lab/openpose/blob/master/doc/advanced/calibration_module.md)

### kinectWrapperæŠ¥é”™

- åœ¨ä»£ç æ‰§è¡ŒæœŸé—´äº§ç”Ÿå¦‚ä¸‹æœ‰å…³USBçš„æŠ¥é”™ï¼š

  ```bash
  ibusb_claim_interface(usbcmd->libusb, usbcmd->interface) returned LIBUSB_ERROR_BUSY in usb_cmd_create
  ```

  åŸå› ä¸ºåœ¨ä»£ç ä¸­åœ¨æ²¡æœ‰è°ƒç”¨closeå‡½æ•°çš„æƒ…å†µä¸‹ï¼Œå¤šæ¬¡è°ƒç”¨openå‡½æ•°ï¼š

  ```c++
  k4a::device::open(i);
  
  k4a::device::close();
  ```

  åœ¨ä¸€è½®å®Œæ•´wrapperè¿‡ç¨‹ä¸­ï¼Œopenå‡½æ•°åªèƒ½è¢«è°ƒç”¨ä¸€æ¬¡ï¼Œä¹‹åå¦‚éœ€è¦ä½¿ç”¨device_handleï¼Œä½¿ç”¨å¼•ç”¨ä¼ é€’å³å¯ã€‚

- `k4a::device`ç±»ä¸­æ²¡æœ‰æ‹·è´æ„é€ å‡½æ•°ï¼Œå…¶ä»£ç å‘ˆç°å¦‚ä¸‹ï¼š

  ```c++
  device(const device&) = delete
  ```

  è¿™æ˜¯ä¸€ä¸ª C++ ä¸­çš„ç‰¹æ®Šå£°æ˜ï¼Œç”¨äºåˆ é™¤ï¼ˆ`= delete`ï¼‰æ‹·è´æ„é€ å‡½æ•°ã€‚è¿™ç§å£°æ˜å‘Šè¯‰ç¼–è¯‘å™¨ä¸å…è®¸ä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°åˆ›å»ºè¯¥ç±»çš„å¯¹è±¡çš„å‰¯æœ¬ã€‚

  è¿™æ ·çš„è®¾è®¡é€šå¸¸å‡ºç°åœ¨éœ€è¦ç²¾ç¡®åœ°æ§åˆ¶å¯¹è±¡çš„æ‹·è´è¡Œä¸ºçš„æƒ…å†µä¸‹ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç±»ç®¡ç†äº†èµ„æºï¼ˆæ¯”å¦‚å†…å­˜æˆ–æ–‡ä»¶å¥æŸ„ï¼‰ï¼Œé€šè¿‡ç¦ç”¨æ‹·è´æ„é€ å‡½æ•°å¯ä»¥é˜²æ­¢æ„å¤–çš„èµ„æºå…±äº«æˆ–é‡Šæ”¾ã€‚åœ¨ç°ä»£ C++ ä¸­ï¼Œé€šå¸¸æ¨èä½¿ç”¨ç§»åŠ¨è¯­ä¹‰æ¥ä»£æ›¿æ‹·è´ï¼Œå› ä¸ºç§»åŠ¨æ“ä½œæ›´é«˜æ•ˆä¸”æ›´é€‚åˆå…·æœ‰èµ„æºç®¡ç†èŒè´£çš„ç±»ã€‚

## 2023å¹´10æœˆ15å·

### åŒæ­¥ä»£ç DEBUG

- è¿è¡ŒMultiDeviceCaptureçš„start_cameraå‡½æ•°ï¼Œä¼šæ‰¾ä¸åˆ°sub_deviceçš„handleã€‚

  åŸå› ï¼šåœ¨æ‰§è¡ŒMultiDeviceCaptureçš„DeInitå‡½æ•°æ—¶ï¼Œæ²¡æœ‰å°†é™„å±è®¾å¤‡å‘é‡è¿›è¡Œclearæ“ä½œï¼Œå¯¼è‡´ä¹‹åçš„Initæ“ä½œåœ¨å·²ç»å˜æˆç©ºæŒ‡é’ˆçš„device handleåæ·»åŠ äº†æ–°çš„device handleã€‚è¿™ä¹Ÿå¯¼è‡´sub_devices vectorä¸­å…ƒç´ ä¸ªæ•°æ¯”å®é™…çš„é™„å±è®¾å¤‡ä¸ªæ•°å¤šï¼Œä»è€Œåœ¨ä¹‹åè¿›è¡Œstart_cameraæ—¶è®¿é—®åˆ°äº†ç©ºæŒ‡é’ˆçš„device handle

### å¤–å‚æ ‡å®š

è®¾å¤‡åŒæ­¥é—®é¢˜æå®šåï¼ˆjy yydsï¼ï¼‰åŒæ—¶è¿æ¥ä¸‰å°kinectå¹¶æ’ä¸ŠåŒæ­¥çº¿ï¼Œç„¶å**æ”¶é›†å›¾ç‰‡**ï¼š

`./build/examples/openpose/openpose.bin --kinect_camera --frame_undistort --write_images ./extrinsic_images`

è¿™ä¼šåŒæ—¶ä¸ºä¸‰å°kinectæ‹æ‘„å›¾ç‰‡ï¼ŒæŒ‰ç…§ `number_rendered.png number_rendered_1.png number_rendered_2.png`çš„å½¢å¼å­˜å‚¨ï¼Œä¸€ç»„ä¸‰å¼ ã€‚

æ¥ç€**å¼€å§‹æ ‡å®š**ã€‚æ ‡å®šå¤–å‚æ—¶ï¼Œä»¥å…¶ä¸­ä¸€ä¸ªkinectçš„ç›¸æœºåæ ‡ç³»ä¸ºä¸–ç•Œåæ ‡ç³»åŸç‚¹ï¼Œç„¶ååˆ†åˆ«è®¡ç®—å…¶ä½™kinectç›¸å¯¹å…¶çš„æ—‹è½¬çŸ©é˜µRå’Œå¹³ç§»çŸ©é˜µtã€‚ï¼ˆç†è®ºï¼šå¯¹äºå•ç›®æ‘„åƒæœºï¼Œæ²¡æœ‰å¿…è¦æ ‡å®šå…¶å¤–å‚ï¼ˆæˆ–è€…è¯´å…¶æ‹æ‘„çš„æ¯ä¸€å¼ å›¾ç‰‡éƒ½å¯¹åº”ä¸€ä¸ªå¤–å‚ï¼‰ï¼Œå› ä¸ºå®Œå…¨å¯ä»¥è®©ç›¸æœºå…‰å¿ƒåæ ‡ç³»ä¸ä¸–ç•Œåæ ‡ç³»é‡åˆï¼›ä¹Ÿå› æ­¤å•ç›®æ‘„åƒæœºæ— æ³•å®Œæˆä¸‰ç»´çš„é‡å»ºï¼‰

```bash
./build/examples/calibration/calibration.bin --mode 2 --grid_square_size_mm 100.0 --grid_number_inner_corners "9x6" --omit_distortion --calibration_image_dir ./extrinsic_images/ --cam0 0 --cam1 1 --camera_parameter_folder ./models/cameraParameters/kinect/
```

æ³¨æ„è¦åŠ ä¸Šcamera_parameter_folderçš„flagï¼å¦åˆ™é»˜è®¤çš„å‚æ•°æ–‡ä»¶è·¯å¾„ä¸º`models/cameraParameters/flir/`ï¼Œä¼šæŠ¥é”™ï¼š

```bash
vector::\_M\_range\_check: \_\_n(which is 1) >= this -> size() (which is 0)
```

å»ºè®®æ‹æ‘„250ç»„ä»¥ä¸Šå›¾ç‰‡è·å¾—å¥½çš„æ ‡å®šæ•ˆæœã€‚

## 2023å¹´10æœˆ22å·

**ï¼ˆå¾…å¯ä¸ºæäº¤ï¼‰**

## 2023å¹´10æœˆ26å·

### ç»“é¢˜æŠ¥å‘Šï¼ˆddlï¼š11æœˆ12å·ï¼‰æ— å­—æ•°è¦æ±‚

- é¡¹ç›®ç ”ç©¶å†…å®¹ â€”â€” kw
- é¡¹ç›®ç ”ç©¶æ–¹æ¡ˆ 
- é¡¹ç›®å®Œæˆæƒ…å†µ â€”â€” kw
- é¡¹ç›®ç‰¹è‰²ä¸åˆ›æ–°
- é¡¹ç›®ç ”ç©¶å–å¾—çš„æˆæœ â€”â€” kw
- é¡¹ç›®æˆå‘˜è´¡çŒ®æ’åºä¸å·¥ä½œå¤‡æ³¨
- é¡¹ç›®è¿˜å­˜åœ¨å“ªäº›é—®é¢˜ï¼Œæœ‰å“ªäº›å»ºè®®ã€‚
- é¡¹ç›®ç ”ç©¶å¿ƒå¾— â€”â€” kw

### é¡¹ç›®ç ”ç©¶è®ºæ–‡ï¼ˆddlï¼š11æœˆ12å·ï¼‰10000å­—

ï¼ˆç ”ç©¶å†…å®¹ã€æ–¹æ³•åŠç ”ç©¶æˆæœï¼‰

- å¼•è¨€ â€”â€” kw
- é¡¹ç›®å…ƒç´ ä»‹ç»
  - ä¸‰ç»´é‡å»º[3D äººä½“å§¿æ€ä¼°è®¡ç®€è¿° - çŸ¥ä¹ (zhihu.com)](https://zhuanlan.zhihu.com/p/400922771)
  - Openposeé¡¹ç›®
  - ç›¸æœºæ ‡å®šåŸç† â€”â€” kw
  - Azure Kinect â€”â€” kw
  
- ç ”ç©¶å·¥ä½œï¼ˆçŒ›çŒ›æŠŠæ—¥å¿—å†…å®¹æ‰©å†™ï¼‰
  - å·¥ä½œæµç¨‹
  - ç¯å¢ƒé…ç½® â€”â€” kw
  - æºç ä¿®æ”¹
  - å‚æ•°æ ‡å®š â€”â€” kw
- åº”ç”¨åœºæ™¯ä¸ç¤¾ä¼šæ•ˆç›Š
- æ€»ç»“

### é¡¹ç›®ç ”ç©¶ç»¼è¿°ï¼ˆddlï¼š11æœˆ12å·ï¼‰2000å­—

ï¼ˆåˆ›æ–°ç‚¹ã€ç‰¹è‰²å’Œåº”ç”¨åŠæ¨å¹¿å‰æ™¯ï¼‰

- ç ”ç©¶èƒŒæ™¯å’Œæ–¹å‘ï¼ˆä¸Šæ–‡å¼•è¨€ï¼‰
- ç ”ç©¶ç†è®ºåŸºç¡€ï¼ˆä¸Šæ–‡å…ƒç´ ä»‹ç»ï¼‰
- å®éªŒè¿‡ç¨‹ï¼ˆä¸Šæ–‡ç ”ç©¶å·¥ä½œï¼‰
- åº”ç”¨ä¸æ¨å¹¿å‰æ™¯ï¼ˆä¸Šæ–‡åº”ç”¨åœºæ™¯ï¼‰
- æ€»ç»“ï¼ˆä¸Šæ–‡æ€»ç»“ï¼‰

### ä¸ªäººæ€»ç»“ï¼ˆddlï¼š11æœˆ12å·ï¼‰2000å­—

ï¼ˆ**æ¯äººä¸€ä»½**ï¼Œå¯ä»¥æ”¾ç…§ç‰‡ï¼‰

ï¼ˆæ‰¿æ‹…çš„å·¥ä½œï¼Œå‘æŒ¥çš„ä½œç”¨ï¼Œä»¥åŠåœ¨èƒ½åŠ›åŸ¹å…»å’Œç´ è´¨æé«˜ç‰¹åˆ«æ˜¯åœ¨åˆ›æ–°æ€ç»´å’Œåˆ›æ–°å®è·µæ–¹é¢çš„ä½“éªŒå’Œæ”¶è·ï¼‰

## 2023å¹´11æœˆ18å·

### ç»“é¡¹ç­”è¾©ppt

- é¡¹ç›®èƒŒæ™¯

  - ç ”ç©¶ç›®çš„ï¼ˆIntroductionï¼‰  **ä¸€é¡µ**

    åº”ç”¨å‰æ™¯ï¼Œæ”¾ä¸€äº›å›¾ï¼Œç®€å•ä¸€ç¬”å¸¦è¿‡

  - ç›¸å…³å·¥ä½œï¼ˆrelated worksï¼‰  **ä¸€é¡µ**

    æ”¾å‡ å¼ å›¾ï¼ˆå¯¹åº”é¡¹ç›®è®ºæ–‡ä¸­â€œä¸‰ç»´é‡å»ºâ€éƒ¨åˆ†ï¼‰ï¼Œç®€å•ä»‹ç»å¼•å‡ºæˆ‘ä»¬æ‰€é€‰ç”¨çš„é‡å»ºæ–¹æ¡ˆ

  - é—®é¢˜é™ˆè¿°ï¼ˆProblem statementï¼‰ï¼ˆå¯ä»¥ç†è§£ä¸ºé¡¹ç›®çš„ç†è®ºæ”¯æ’‘ï¼‰

    - Openposeé¡¹ç›®  **ä¸€é¡µ**

      ç®€å•ä»‹ç»Openposeï¼ˆå¯¹åº”é¡¹ç›®è®ºæ–‡ä¸­çš„â€œOpenposeé¡¹ç›®â€ï¼‰ï¼Œä¸€é¡µï¼Œé‡ç‚¹è®²ä¸€ä¸‹PCMä¸PAFçš„æ¦‚å¿µä»¥åŠ2Dè¯†åˆ«æœ€åå¯ä»¥å¾—åˆ°çš„ç»“æœæ˜¯ä»€ä¹ˆã€‚

    - Kinect Aurez Camera  **ä¸€é¡µ**

      ç®€å•ä»‹ç»ç›¸æœºçš„åŠŸèƒ½ï¼Œé‡ç‚¹è¯´ä¸‰ä¸ªç‰¹ç‚¹ï¼šSDKã€åŒæ­¥åŠŸèƒ½ã€æ·±åº¦ç›¸æœºï¼ˆè™½ç„¶æˆ‘ä»¬æ²¡ç”¨ï¼Œä½†æ˜¯å¯ä»¥æåŠä¸€ä¸‹ï¼‰

    - ç›¸æœºæ ‡å®š  **ä¸€é¡µ**

      ç®€å•ä»‹ç»ä½¿ç”¨çš„æ ‡å®šæ–¹æ³•ï¼Œé‡ç‚¹è®²æ¸…æ¥šæ ‡å®šå¾—åˆ°äº†çš„çŸ©é˜µï¼šå†…å‚çŸ©é˜µä¸å¤–å‚çŸ©é˜µ

---

- ç ”ç©¶å·¥ä½œï¼ˆExperimentï¼‰

  - ç¯å¢ƒé…ç½®ä¸ä»£ç éƒ¨ç½²  **ä¸€é¡µ**
  - å­¦ä¹ å¹¶ç†Ÿæ‚‰SDKçš„ä½¿ç”¨  **ä¸€é¡µ**
  - æ‰©å±•Openposeæºä»£ç   **ä¸€é¡µ**
  - ç³»ç»Ÿæ­å»ºä¸ç›¸æœºæ ‡å®š  **ä¸€é¡µ**

- ç ”ç©¶æˆæœï¼ˆResultï¼‰

  - æˆæœè¯„ä»·  **ä¸€é¡µ**

    é¡¹ç›®è§†é¢‘ã€é¡¹ç›®å®ç°çš„æŒ‡æ ‡ã€é¡¹ç›®çš„ç¼ºé™·

- ç ”ç©¶æ€»ç»“ï¼ˆConclusionï¼‰

  - é¡¹ç›®å±•æœ›  **ä¸€é¡µ**

    å¯èƒ½çš„æ”¹è¿›æ–¹æ³•ã€å¯ä»¥ä¼˜åŒ–æ‰©å±•çš„ä»£ç æäº¤åˆ°Openposeçš„åˆ†æ”¯

  - è‡´è°¢  **ä¸€é¡µ**

    å¥—è¯ï¼Œè‡ªå·±èƒ½åŠ›å¾—åˆ°äº†ä»€ä¹ˆé”»ç‚¼ï¼Œæ„Ÿè°¢é™ªä¼´ä¸€è·¯çš„ä¼™ä¼´ï¼Œæ„Ÿè°¢è€å¸ˆçš„æŒ‡å¯¼ä¸å­¦ç”Ÿåˆ›æ–°ä¸­å¿ƒçš„æ”¯æŒã€‚

  

â€‹	
